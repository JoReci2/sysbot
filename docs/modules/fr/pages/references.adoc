= Références API

== Introduction

Cette page fournit une référence complète de l'API SysBot. Pour des exemples d'utilisation, consultez le xref:quickstart.adoc[Démarrage rapide] ou les guides xref:robotframework.adoc[Robot Framework] et xref:unittest.adoc[unittest].

== Classe principale Sysbot

=== Création d'instance

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()
----

=== Méthodes de gestion des sessions

==== open_session()

Ouvre une nouvelle session vers un système distant.

[source,python]
----
bot.open_session(
    alias="identifiant_unique",
    protocol="ssh|winrm|http|socket|localhost",
    product="bash|powershell|basicauth|tcp|udp",
    host="adresse_hote",
    port=numero_port,  # Optionnel, utilise le port par défaut
    login="nom_utilisateur",  # Optionnel pour certains protocoles
    password="mot_de_passe"  # Optionnel pour certains protocoles
)
----

*Paramètres :*

* `alias` (str) : Identifiant unique pour la session
* `protocol` (str) : Type de protocole (ssh, winrm, http, socket, localhost)
* `product` (str) : Produit/service spécifique (bash, powershell, basicauth, tcp, udp)
* `host` (str) : Nom d'hôte ou adresse IP
* `port` (int, optionnel) : Numéro de port (utilise les valeurs par défaut si non spécifié)
* `login` (str, optionnel) : Nom d'utilisateur pour l'authentification
* `password` (str, optionnel) : Mot de passe pour l'authentification

*Retourne :* Dictionnaire avec StatusCode, Result, Error, Metadata

==== close_session()

Ferme une session spécifique.

[source,python]
----
bot.close_session("alias_session")
----

*Paramètres :*

* `alias` (str) : Identifiant de la session à fermer

*Retourne :* Dictionnaire avec StatusCode, Result, Error, Metadata

==== close_all_sessions()

Ferme toutes les sessions actives.

[source,python]
----
bot.close_all_sessions()
----

*Retourne :* Dictionnaire avec StatusCode, Result, Error, Metadata

=== Méthodes d'exécution de commandes

==== execute_command()

Exécute une commande sur un système distant.

[source,python]
----
# Pour SSH/WinRM/Localhost
resultat = bot.execute_command("alias_session", "commande")

# Pour HTTP
resultat = bot.execute_command(
    "alias_session",
    "GET|POST|PUT|DELETE|PATCH",
    endpoint="/chemin/api",
    headers={"Custom-Header": "valeur"},
    body={"cle": "valeur"}
)

# Pour Socket
resultat = bot.execute_command("alias_session", "donnees_a_envoyer")
----

*Paramètres :*

* `alias` (str) : Identifiant de la session
* `command` (str) : Commande à exécuter ou méthode HTTP
* `endpoint` (str, HTTP uniquement) : Chemin du point de terminaison de l'API
* `headers` (dict, HTTP uniquement) : En-têtes HTTP personnalisés
* `body` (dict, HTTP uniquement) : Corps de la requête pour POST/PUT/PATCH
* Paramètres supplémentaires selon le type de connecteur

*Retourne :* Dictionnaire avec StatusCode, Result, Error, Metadata

=== Méthodes de gestion des modules

==== load_module()

Charge un module SysBot.

[source,python]
----
bot.load_module("linux")
bot.load_module("windows")
----

*Paramètres :*

* `module_name` (str) : Nom du module à charger

*Retourne :* Référence du module

==== Accès aux modules

[source,python]
----
# Accéder au module chargé
bot.modules.linux.get_system_info("alias")
bot.modules.windows.get_services("alias")
----

=== Méthodes de gestion des secrets

==== store_secret()

Stocke une valeur secrète en toute sécurité.

[source,python]
----
bot.store_secret("nom_cle", "valeur_secrete")
----

*Paramètres :*

* `key` (str) : Nom de la clé pour le secret
* `value` (str) : Valeur à stocker en toute sécurité

==== get_secret()

Récupère une valeur secrète stockée.

[source,python]
----
valeur = bot.get_secret("nom_cle")
----

*Paramètres :*

* `key` (str) : Nom de la clé pour le secret

*Retourne :* Valeur du secret stocké

== Connecteurs

=== Connecteur SSH

Fournit une connectivité SSH pour les systèmes Linux/Unix.

[source,python]
----
bot.open_session(
    alias="serveur_linux",
    protocol="ssh",
    product="bash",
    host="192.168.1.100",
    port=22,
    login="utilisateur",
    password="mot_de_passe"
)
----

*Ports par défaut :* 22

*Produits supportés :* bash, powershell (pour les systèmes Linux avec PowerShell)

=== Connecteur WinRM

Fournit une connectivité WinRM pour les systèmes Windows.

[source,python]
----
bot.open_session(
    alias="serveur_windows",
    protocol="winrm",
    product="powershell",
    host="192.168.1.200",
    port=5986,
    login="administrateur",
    password="mot_de_passe"
)
----

*Ports par défaut :* 5986 (HTTPS), 5985 (HTTP)

*Produits supportés :* powershell

=== Connecteur HTTP

Fournit une connectivité HTTP/HTTPS pour les API REST.

[source,python]
----
bot.open_session(
    alias="mon_api",
    protocol="http",
    product="basicauth",
    host="api.exemple.com",
    port=443,
    login="utilisateur_api",
    password="cle_api"
)
----

*Ports par défaut :* 443 (HTTPS), 80 (HTTP)

*Produits supportés :* basicauth, generic (supportant 11 méthodes d'authentification)

*Méthodes d'authentification supportées :*

* none - Pas d'authentification
* basic - Authentification de base
* apikey - Clé API
* bearer - Jeton Bearer
* jwt - JSON Web Token
* oauth1 - OAuth 1.0
* oauth2 - OAuth 2.0
* hmac - Signature HMAC
* certificate - Authentification par certificat
* openid - OpenID Connect
* saml - SAML

=== Connecteur Socket

Fournit une connectivité TCP/UDP socket.

[source,python]
----
# Socket TCP
bot.open_session(
    alias="serveur_tcp",
    protocol="socket",
    product="tcp",
    host="192.168.1.100",
    port=8080
)

# Socket UDP
bot.open_session(
    alias="serveur_udp",
    protocol="socket",
    product="udp",
    host="192.168.1.100",
    port=9090
)
----

*Produits supportés :* tcp, udp

=== Connecteur Localhost

Permet l'exécution de commandes locales sans connexion réseau.

[source,python]
----
bot.open_session(
    alias="local",
    protocol="localhost",
    product="bash"  # ou "powershell" sur Windows
)
----

*Produits supportés :* bash, powershell

== Modules

=== Module Linux

Fournit des fonctionnalités de haut niveau pour les systèmes Linux.

==== get_system_info()

[source,python]
----
info = bot.modules.linux.get_system_info("alias")
----

Récupère les informations système (nom d'hôte, OS, etc.)

==== list_processes()

[source,python]
----
processus = bot.modules.linux.list_processes("alias")
----

Liste tous les processus en cours d'exécution

==== check_service()

[source,python]
----
statut = bot.modules.linux.check_service("alias", "nginx")
----

Vérifie le statut d'un service

=== Module Windows

Fournit des fonctionnalités de haut niveau pour les systèmes Windows.

==== get_services()

[source,python]
----
services = bot.modules.windows.get_services("alias")
----

Liste tous les services Windows

==== get_system_info()

[source,python]
----
info = bot.modules.windows.get_system_info("alias")
----

Récupère les informations système Windows

== Plugins

=== Plugin Listener de base de données

Stocke les résultats d'exécution des tests Robot Framework dans diverses bases de données.

Consultez xref:listener_plugin.adoc[Documentation du plugin Listener] pour les détails complets.

*Bases de données supportées :*

* SQLite
* MySQL
* PostgreSQL
* MongoDB

*Utilisation :*

[source,bash]
----
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:type_bd:chaine_connexion:nom_campagne tests/
----

== Format de réponse

Toutes les opérations SysBot retournent un dictionnaire standardisé :

[source,python]
----
{
    "StatusCode": 0,           # 0 = succès, >0 = code d'erreur
    "Result": "données",       # Données de sortie ou résultat
    "Error": "",               # Message d'erreur (vide en cas de succès)
    "Metadata": {              # Métadonnées supplémentaires
        "execution_time": 1.23,
        "additional_info": "..."
    }
}
----

== Gestion des erreurs

=== Codes d'état

* `0` : Succès
* `1` : Erreur générique
* `2` : Erreur de connexion
* `3` : Erreur d'authentification
* `4` : Erreur d'exécution de commande
* `5` : Délai d'attente dépassé

=== Gestion des exceptions

[source,python]
----
try:
    resultat = bot.execute_command("alias", "commande")
    if resultat["StatusCode"] == 0:
        print(f"Succès : {resultat['Result']}")
    else:
        print(f"Erreur : {resultat['Error']}")
except Exception as e:
    print(f"Exception : {str(e)}")
----

== Exemples

=== Exemple complet

[source,python]
----
from sysbot.Sysbot import Sysbot

# Créer une instance
bot = Sysbot()

try:
    # Ouvrir une session SSH
    bot.open_session(
        alias="serveur",
        protocol="ssh",
        product="bash",
        host="192.168.1.100",
        login="utilisateur",
        password="mot_de_passe"
    )
    
    # Exécuter une commande
    resultat = bot.execute_command("serveur", "uname -a")
    
    if resultat["StatusCode"] == 0:
        print(f"Informations système : {resultat['Result']}")
    else:
        print(f"Erreur : {resultat['Error']}")
    
    # Charger et utiliser un module
    bot.load_module("linux")
    info = bot.modules.linux.get_system_info("serveur")
    print(f"Informations détaillées : {info}")
    
finally:
    # Toujours fermer les sessions
    bot.close_all_sessions()
----

== Voir aussi

* xref:quickstart.adoc[Démarrage rapide] - Commencer avec SysBot
* xref:robotframework.adoc[Guide Robot Framework] - Intégration Robot Framework
* xref:unittest.adoc[Guide Unittest] - Intégration Python unittest
* xref:developer.adoc[Guide du développeur] - Développement et contribution

= Manuel utilisateur
:description: Guide utilisateur complet pour SysBot - bibliothèque d'automatisation de tests système

== Vue d'ensemble

SysBot est une bibliothèque complète d'automatisation de tests système qui fournit une interface unifiée pour se connecter et tester divers systèmes via différents protocoles. Conçue avec Robot Framework à l'esprit, elle offre un support robuste pour les suites de tests Robot Framework et Python unittest.

=== Fonctionnalités

include::partial$features.adoc[]

=== Dépôt

* *GitHub* : https://github.com/JoReci2/sysbot
* *Licence* : MIT

== Installation

=== Prérequis

include::partial$prerequisites.adoc[]

=== Installation depuis PyPI

La méthode la plus simple pour installer SysBot :

include::partial$install-pip.adoc[]

=== Installation avec support de base de données

Si vous souhaitez utiliser le plugin d'écoute de base de données :

[source,bash]
----
# Installer avec tous les supports de base de données
pip install sysbot[all_databases]

# Ou installer avec un support de base de données spécifique
pip install sysbot[mysql]
pip install sysbot[postgresql]
pip install sysbot[mongodb]
----

=== Installation depuis les sources

Pour la dernière version de développement :

[source,bash]
----
# Cloner le dépôt
git clone https://github.com/JoReci2/sysbot.git
cd sysbot

# Créer un environnement virtuel
python -m venv venv

# Activer l'environnement virtuel
# Sur Linux/macOS :
source venv/bin/activate

# Sur Windows :
venv\Scripts\activate

# Installer en mode développement
pip install -e .
----

=== Vérification de l'installation

Vérifier que SysBot est correctement installé :

[source,python]
----
# Vérification Python
python -c "import sysbot; print(sysbot.__version__)"

# Ou en Python interactif
python
>>> from sysbot.Sysbot import Sysbot
>>> bot = Sysbot()
>>> print("SysBot installé avec succès !")
----

== Démarrage rapide

=== Concepts de base

==== Composants principaux

* *Sysbot* : Classe principale qui gère toutes les opérations
* *Session* : Une connexion à un système distant
* *Connecteur* : Gestionnaire de connexion spécifique au protocole (SSH, WinRM, HTTP, Socket)
* *Module* : Fonctionnalités pré-construites pour des systèmes spécifiques (Linux, Windows)
* *Plugin* : Composants utilitaires pour la gestion des données et les intégrations externes
* *Gestionnaire de secrets* : Stockage sécurisé pour les données sensibles

=== Votre première connexion

==== Connexion SSH simple

[source,python]
----
include::example$basic-ssh.py[]
----

==== Connexion WinRM Windows

[source,python]
----
include::example$basic-winrm.py[]
----

==== Connexion API HTTP

[source,python]
----
include::example$basic-http.py[]
----

=== Gestion des sessions

==== Mise en cache des sessions

SysBot met automatiquement en cache les sessions pour améliorer les performances :

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Ouvrir une session
bot.open_session(
    alias="serveur1",
    protocol="ssh",
    product="bash",
    host="192.168.1.100",
    login="utilisateur",
    password="mot_de_passe"
)

# Utiliser la session plusieurs fois - utilise la session mise en cache
bot.execute_command("serveur1", "commande1")
bot.execute_command("serveur1", "commande2")
bot.execute_command("serveur1", "commande3")

# Fermer la session
bot.close_session("serveur1")
----

==== Gestion de plusieurs sessions

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Ouvrir plusieurs sessions
bot.open_session(alias="linux1", protocol="ssh", product="bash", 
                 host="192.168.1.100", login="utilisateur", password="passe")
bot.open_session(alias="linux2", protocol="ssh", product="bash",
                 host="192.168.1.101", login="utilisateur", password="passe")
bot.open_session(alias="windows1", protocol="winrm", product="powershell",
                 host="192.168.1.200", login="admin", password="passe")

# Utiliser différentes sessions
bot.execute_command("linux1", "hostname")
bot.execute_command("linux2", "hostname")
bot.execute_command("windows1", "hostname")

# Fermer toutes les sessions à la fois
bot.close_all_sessions()
----

=== Utilisation de modules

Les modules fournissent des fonctionnalités de haut niveau pour des tâches courantes :

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Ouvrir une session
bot.open_session(
    alias="serveur",
    protocol="ssh",
    product="bash",
    host="192.168.1.100",
    login="utilisateur",
    password="mot_de_passe"
)

# Utiliser le module Linux pour des opérations système
bot.load_module("linux")
resultat = bot.modules.linux.get_system_info("serveur")
print(f"Informations système : {resultat}")

# Obtenir les processus en cours d'exécution
processus = bot.modules.linux.list_processes("serveur")
print(f"Processus : {processus}")

bot.close_all_sessions()
----

=== Gestion des secrets

Stocker et récupérer en toute sécurité des informations sensibles :

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Stocker un secret
bot.store_secret("mon_mot_de_passe", "valeur_super_secrete")

# Récupérer et utiliser le secret
mot_de_passe = bot.get_secret("mon_mot_de_passe")
bot.open_session(
    alias="serveur_securise",
    protocol="ssh",
    product="bash",
    host="192.168.1.100",
    login="utilisateur",
    password=mot_de_passe
)

bot.close_all_sessions()
----

== Intégration Robot Framework

=== Configuration

Installer SysBot et Robot Framework :

[source,bash]
----
pip install sysbot robotframework
----

=== Importer SysBot

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot
----

=== Exemples de base

==== Test de connexion SSH

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot

*** Test Cases ***
Test Connexion SSH
    Open Session    alias=serveur_linux
    ...             protocol=ssh
    ...             product=bash
    ...             host=192.168.1.100
    ...             login=utilisateur
    ...             password=mot_de_passe
    
    ${resultat}=    Execute Command    serveur_linux    hostname
    Should Not Be Empty    ${resultat}
    Log    ${resultat}
    
    Close Session    serveur_linux
----

==== Test de connexion WinRM

[source,robotframework]
----
*** Test Cases ***
Test Connexion Windows
    Open Session    alias=serveur_windows
    ...             protocol=winrm
    ...             product=powershell
    ...             host=192.168.1.200
    ...             login=administrateur
    ...             password=mot_de_passe
    
    ${resultat}=    Execute Command    serveur_windows    Get-ComputerInfo
    Should Contain    ${resultat}    Windows
    
    Close All Sessions
----

==== Test API HTTP

[source,robotframework]
----
*** Test Cases ***
Test API REST
    Open Session    alias=mon_api
    ...             protocol=http
    ...             product=basicauth
    ...             host=api.exemple.com
    ...             login=utilisateur_api
    ...             password=mot_de_passe_api
    
    ${reponse}=    Execute Command    mon_api    GET    endpoint=/utilisateurs
    Should Be Equal As Numbers    ${reponse}[StatusCode]    0
    
    Close Session    mon_api
----

=== Utilisation avancée

==== Portée de la suite

SysBot utilise la portée SUITE par défaut, ce qui signifie qu'une instance est partagée entre tous les tests d'une suite :

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot
Suite Setup       Ouvrir Sessions
Suite Teardown    Fermer Toutes Les Sessions

*** Keywords ***
Ouvrir Sessions
    Open Session    alias=serveur1    protocol=ssh    product=bash
    ...             host=192.168.1.100    login=utilisateur    password=passe
    
*** Test Cases ***
Test 1
    ${resultat}=    Execute Command    serveur1    echo "Test 1"
    Should Contain    ${resultat}    Test 1

Test 2
    ${resultat}=    Execute Command    serveur1    echo "Test 2"
    Should Contain    ${resultat}    Test 2
----

==== Utilisation des modules

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot

*** Test Cases ***
Test Avec Module Linux
    Open Session    alias=serveur    protocol=ssh    product=bash
    ...             host=192.168.1.100    login=utilisateur    password=passe
    
    Load Module    linux
    
    ${info_systeme}=    Get System Info    serveur
    Log    Informations système : ${info_systeme}
    
    ${processus}=    List Processes    serveur
    Log    Processus : ${processus}
    
    Close All Sessions
----

=== Plugin d'écoute de base de données

Stocker les résultats des tests dans une base de données :

[source,bash]
----
# Exécuter les tests avec le listener
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:sqlite:results.db:MaCampagne tests/
----

== Intégration Python unittest

=== Exemple de base

==== Test de connexion SSH

[source,python]
----
import unittest
from sysbot.Sysbot import Sysbot


class TestConnexionSSH(unittest.TestCase):
    
    def setUp(self):
        """Configurer avant chaque test"""
        self.bot = Sysbot()
    
    def tearDown(self):
        """Nettoyer après chaque test"""
        self.bot.close_all_sessions()
    
    def test_connexion_ssh_basique(self):
        """Tester une connexion SSH basique"""
        self.bot.open_session(
            alias="serveur_test",
            protocol="ssh",
            product="bash",
            host="192.168.1.100",
            login="utilisateur",
            password="mot_de_passe"
        )
        
        resultat = self.bot.execute_command("serveur_test", "hostname")
        self.assertIsNotNone(resultat)
        self.assertIn("Result", resultat)


if __name__ == '__main__':
    unittest.main()
----

==== Test de connexion WinRM

[source,python]
----
import unittest
from sysbot.Sysbot import Sysbot


class TestConnexionWindows(unittest.TestCase):
    
    def setUp(self):
        self.bot = Sysbot()
        self.bot.open_session(
            alias="serveur_windows",
            protocol="winrm",
            product="powershell",
            host="192.168.1.200",
            login="administrateur",
            password="mot_de_passe"
        )
    
    def tearDown(self):
        self.bot.close_all_sessions()
    
    def test_obtenir_info_ordinateur(self):
        """Tester la récupération d'informations sur l'ordinateur"""
        resultat = self.bot.execute_command(
            "serveur_windows", 
            "Get-ComputerInfo"
        )
        self.assertEqual(resultat["StatusCode"], 0)
        self.assertIn("Windows", resultat["Result"])


if __name__ == '__main__':
    unittest.main()
----

=== Organisation des tests

==== Utilisation de setUpClass et tearDownClass

Pour les ressources partagées entre les tests :

[source,python]
----
import unittest
from sysbot.Sysbot import Sysbot


class TestSuiteLinux(unittest.TestCase):
    
    @classmethod
    def setUpClass(cls):
        """Configurer une fois pour toute la classe de tests"""
        cls.bot = Sysbot()
        cls.bot.open_session(
            alias="serveur_linux",
            protocol="ssh",
            product="bash",
            host="192.168.1.100",
            login="utilisateur",
            password="mot_de_passe"
        )
    
    @classmethod
    def tearDownClass(cls):
        """Nettoyer après tous les tests"""
        cls.bot.close_all_sessions()
    
    def test_systeme_fichiers(self):
        """Tester les opérations du système de fichiers"""
        resultat = self.bot.execute_command("serveur_linux", "ls -la /tmp")
        self.assertEqual(resultat["StatusCode"], 0)
    
    def test_processus(self):
        """Tester les opérations de processus"""
        resultat = self.bot.execute_command("serveur_linux", "ps aux")
        self.assertEqual(resultat["StatusCode"], 0)


if __name__ == '__main__':
    unittest.main()
----

=== Exécution des tests

[source,bash]
----
# Découvrir et exécuter tous les tests
python -m unittest discover tests

# Exécuter un fichier de test spécifique
python -m unittest tests.test_connexions

# Exécuter une classe de test spécifique
python -m unittest tests.test_connexions.TestConnexionSSH

# Mode verbeux
python -m unittest discover tests -v
----

== Plugin d'écoute de base de données

Un plugin d'écoute Robot Framework qui stocke les résultats d'exécution des tests dans diverses bases de données en utilisant SQLAlchemy pour les bases de données SQL.

=== Bases de données supportées

* *SQLite* - Base de données basée sur des fichiers
* *MySQL* - Base de données relationnelle
* *PostgreSQL* - Base de données relationnelle avancée
* *MongoDB* - Base de données NoSQL orientée documents

=== Installation

==== Utilisation de pip avec extras

[source,bash]
----
# Installer avec le support de toutes les bases de données
pip install sysbot[all_databases]

# Ou installer avec le support d'une base de données spécifique
pip install sysbot[mysql]
pip install sysbot[postgresql]
pip install sysbot[mongodb]
----

=== Utilisation

Le listener peut être utilisé avec l'option `--listener` de Robot Framework :

[source,bash]
----
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:type_bd:chaine_connexion:nom_campagne tests/
----

==== Exemples SQLite

[source,bash]
----
# Stocker les résultats dans le fichier results.db avec le nom de campagne
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:sqlite:results.db:MaCampagne tests/

# Stocker les résultats dans /tmp/test_results.db
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:sqlite:/tmp/test_results.db:MonProjet tests/
----

==== Exemples MySQL

[source,bash]
----
# Connexion à la base de données MySQL
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:mysql:utilisateur:motdepasse@localhost/testdb:MaCampagne tests/

# Avec un port personnalisé
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:mysql:utilisateur:motdepasse@localhost:3307/testdb:MaCampagne tests/
----

==== Exemples PostgreSQL

[source,bash]
----
# Connexion à la base de données PostgreSQL
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:postgresql:utilisateur:motdepasse@localhost/testdb:MaCampagne tests/

# Avec un port personnalisé
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:postgresql:utilisateur:motdepasse@localhost:5433/testdb:MaCampagne tests/
----

==== Exemples MongoDB

[source,bash]
----
# Connexion à la base de données MongoDB
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:mongodb:mongodb://localhost:27017/testdb:MaCampagne tests/

# Avec authentification
robot --listener sysbot.plugins.robot.listener.bdd.Bdd:mongodb:utilisateur:motdepasse@localhost:27017/testdb:MaCampagne tests/
----

=== Schéma de base de données

==== Bases de données SQL (SQLite, MySQL, PostgreSQL)

Le listener crée une structure hiérarchique avec quatre tables :

*test_campaigns*

[cols="1,1,3"]
|===
|Colonne |Type |Description

|id
|INTEGER/SERIAL
|Clé primaire

|name
|VARCHAR(500)
|Nom de la campagne

|start_time
|TIMESTAMP
|Heure de début de la campagne

|end_time
|TIMESTAMP
|Heure de fin de la campagne

|description
|TEXT
|Description de la campagne
|===

*test_suites*

[cols="1,1,3"]
|===
|Colonne |Type |Description

|id
|INTEGER/SERIAL
|Clé primaire

|campaign_id
|INTEGER
|Clé étrangère vers test_campaigns

|name
|VARCHAR(500)
|Nom de la suite

|doc
|TEXT
|Documentation de la suite

|start_time
|TIMESTAMP
|Heure de début de la suite

|end_time
|TIMESTAMP
|Heure de fin de la suite

|status
|VARCHAR(50)
|Statut de la suite (PASS/FAIL)

|message
|TEXT
|Message de la suite

|metadata
|TEXT
|Métadonnées de la suite (JSON)
|===

*test_cases*

[cols="1,1,3"]
|===
|Colonne |Type |Description

|id
|INTEGER/SERIAL
|Clé primaire

|suite_id
|INTEGER
|Clé étrangère vers test_suites

|name
|TEXT
|Nom du cas de test

|doc
|TEXT
|Documentation du cas de test

|tags
|TEXT
|Tags du cas de test (séparés par des virgules)

|start_time
|TIMESTAMP
|Heure de début du test

|end_time
|TIMESTAMP
|Heure de fin du test

|status
|TEXT
|Statut du test (PASS/FAIL)

|message
|TEXT
|Message du test
|===

*keywords*

[cols="1,1,3"]
|===
|Colonne |Type |Description

|id
|INTEGER/SERIAL
|Clé primaire

|test_id
|INTEGER
|Clé étrangère vers test_cases

|name
|TEXT
|Nom du mot-clé

|library
|TEXT
|Nom de la bibliothèque

|start_time
|TIMESTAMP
|Heure de début du mot-clé

|end_time
|TIMESTAMP
|Heure de fin du mot-clé

|status
|TEXT
|Statut du mot-clé

|message
|TEXT
|Message du mot-clé
|===

==== MongoDB

Le listener crée trois collections avec une structure similaire :

* `test_suites`
* `test_cases`
* `keywords`

=== Interrogation des résultats

==== SQLite

[source,bash]
----
# Voir toutes les suites de tests
sqlite3 results.db "SELECT * FROM test_suites;"

# Voir tous les cas de tests avec leur statut
sqlite3 results.db "SELECT name, status, start_time, end_time FROM test_cases;"

# Compter les tests par statut
sqlite3 results.db "SELECT status, COUNT(*) FROM test_cases GROUP BY status;"

# Voir les tests échoués
sqlite3 results.db "SELECT name, message FROM test_cases WHERE status='FAIL';"
----

== Dépannage

=== Problèmes de connexion courants

==== Connexion SSH refusée

[source,text]
----
Assurez-vous que le serveur SSH est en cours d'exécution
Vérifiez le pare-feu et les règles de sécurité du réseau
Vérifiez les identifiants et les permissions
----

==== Délai d'attente WinRM

[source,text]
----
Vérifiez que WinRM est activé sur le serveur Windows
Vérifiez la configuration du port (5986 pour HTTPS, 5985 pour HTTP)
Assurez-vous que les règles de pare-feu autorisent la connexion WinRM
----

==== Erreurs d'authentification HTTP

[source,text]
----
Vérifiez que la méthode d'authentification est correcte
Vérifiez que les identifiants sont valides
Assurez-vous que l'API attend le format d'authentification que vous utilisez
----

== Support

Pour les rapports de bugs et les demandes de fonctionnalités, veuillez utiliser le système de suivi des problèmes GitHub :
https://github.com/JoReci2/sysbot/issues

== Auteur

Thibault SCIRE - https://github.com/thibaultscire

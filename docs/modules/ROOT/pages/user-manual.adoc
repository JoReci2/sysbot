= User Manual
:description: Complete user guide for SysBot - system test automation library

== Overview

SysBot is a comprehensive system test automation library that provides a unified interface for connecting to and testing various systems through different protocols. Built with Robot Framework integration in mind, it offers robust support for both Robot Framework and Python unittest test suites.

=== Features

include::partial$features.adoc[]

=== Repository

* **GitHub**: https://github.com/JoReci2/sysbot
* **License**: MIT

== Installation

=== Prerequisites

include::partial$prerequisites.adoc[]

=== Install from PyPI

The simplest way to install SysBot:

include::partial$install-pip.adoc[]

=== Installation with Database Support

If you want to use the database listener plugin:

[source,bash]
----
# Install with all database support
pip install sysbot[all_databases]

# Or install with specific database support
pip install sysbot[mysql]
pip install sysbot[postgresql]
pip install sysbot[mongodb]
----

=== Installation from Source

For the latest development version:

[source,bash]
----
# Clone the repository
git clone https://github.com/JoReci2/sysbot.git
cd sysbot

# Create a virtual environment
python -m venv venv

# Activate virtual environment
# On Linux/macOS:
source venv/bin/activate

# On Windows:
venv\Scripts\activate

# Install in development mode
pip install -e .
----

=== Verifying Installation

Verify that SysBot is correctly installed:

[source,python]
----
# Python verification
python -c "import sysbot; print(sysbot.__version__)"

# Or in interactive Python
python
>>> from sysbot.Sysbot import Sysbot
>>> bot = Sysbot()
>>> print("SysBot installed successfully!")
----

== Quick Start

=== Basic Concepts

==== Core Components

* **Sysbot**: Main class that manages all operations
* **Session**: A connection to a remote system
* **Connector**: Protocol-specific connection handler (SSH, WinRM, HTTP, Socket)
* **Module**: Pre-built functionality for specific systems (Linux, Windows)
* **Plugin**: Utility components for data management and external integrations
* **Secret Manager**: Secure storage for sensitive data

=== Your First Connection

==== Simple SSH Connection

[source,python]
----
include::example$basic-ssh.py[]
----

==== Windows WinRM Connection

[source,python]
----
include::example$basic-winrm.py[]
----

==== HTTP API Connection

[source,python]
----
include::example$basic-http.py[]
----

=== Session Management

==== Session Caching

SysBot automatically caches sessions to improve performance:

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Open a session
bot.open_session(
    alias="server1",
    protocol="ssh",
    product="bash",
    host="192.168.1.100",
    login="user",
    password="password"
)

# Use the session multiple times - uses cached session
bot.execute_command("server1", "command1")
bot.execute_command("server1", "command2")
bot.execute_command("server1", "command3")

# Close the session
bot.close_session("server1")
----

==== Managing Multiple Sessions

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Open multiple sessions
bot.open_session(alias="linux1", protocol="ssh", product="bash", 
                 host="192.168.1.100", login="user", password="pass")
bot.open_session(alias="linux2", protocol="ssh", product="bash",
                 host="192.168.1.101", login="user", password="pass")
bot.open_session(alias="windows1", protocol="winrm", product="powershell",
                 host="192.168.1.200", login="admin", password="pass")

# Use different sessions
bot.execute_command("linux1", "hostname")
bot.execute_command("linux2", "hostname")
bot.execute_command("windows1", "hostname")

# Close all sessions at once
bot.close_all_sessions()
----

=== Using Modules

Modules provide high-level functionality for common tasks:

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Open a session
bot.open_session(
    alias="server",
    protocol="ssh",
    product="bash",
    host="192.168.1.100",
    login="user",
    password="password"
)

# Use the Linux module for system operations
bot.load_module("linux")
result = bot.modules.linux.get_system_info("server")
print(f"System info: {result}")

# Get running processes
processes = bot.modules.linux.list_processes("server")
print(f"Processes: {processes}")

bot.close_all_sessions()
----

=== Secret Management

Store and retrieve sensitive information securely:

[source,python]
----
from sysbot.Sysbot import Sysbot

bot = Sysbot()

# Store a secret
bot.store_secret("my_password", "super_secret_value")

# Retrieve and use the secret
password = bot.get_secret("my_password")
bot.open_session(
    alias="secure_server",
    protocol="ssh",
    product="bash",
    host="192.168.1.100",
    login="user",
    password=password
)

bot.close_all_sessions()
----

== Robot Framework Integration

=== Setup

Install SysBot and Robot Framework:

[source,bash]
----
pip install sysbot robotframework
----

=== Importing SysBot

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot
----

=== Basic Examples

==== SSH Connection Test

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot

*** Test Cases ***
Test SSH Connection
    Open Session    alias=linux_server
    ...             protocol=ssh
    ...             product=bash
    ...             host=192.168.1.100
    ...             login=user
    ...             password=password
    
    ${result}=    Execute Command    linux_server    hostname
    Should Not Be Empty    ${result}
    Log    ${result}
    
    Close Session    linux_server
----

==== WinRM Connection Test

[source,robotframework]
----
*** Test Cases ***
Test Windows Connection
    Open Session    alias=windows_server
    ...             protocol=winrm
    ...             product=powershell
    ...             host=192.168.1.200
    ...             login=administrator
    ...             password=password
    
    ${result}=    Execute Command    windows_server    Get-ComputerInfo
    Should Contain    ${result}    Windows
    
    Close All Sessions
----

==== HTTP API Test

[source,robotframework]
----
*** Test Cases ***
Test REST API
    Open Session    alias=my_api
    ...             protocol=http
    ...             product=basicauth
    ...             host=api.example.com
    ...             login=api_user
    ...             password=api_password
    
    ${response}=    Execute Command    my_api    GET    endpoint=/users
    Should Be Equal As Numbers    ${response}[StatusCode]    0
    
    Close Session    my_api
----

=== Advanced Usage

==== Suite Scope

SysBot uses SUITE scope by default, meaning one instance is shared across all tests in a suite:

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot
Suite Setup       Open Sessions
Suite Teardown    Close All Sessions

*** Keywords ***
Open Sessions
    Open Session    alias=server1    protocol=ssh    product=bash
    ...             host=192.168.1.100    login=user    password=pass
    
*** Test Cases ***
Test 1
    ${result}=    Execute Command    server1    echo "Test 1"
    Should Contain    ${result}    Test 1

Test 2
    ${result}=    Execute Command    server1    echo "Test 2"
    Should Contain    ${result}    Test 2
----

==== Using Modules

[source,robotframework]
----
*** Settings ***
Library    sysbot.Sysbot    WITH NAME    Sysbot

*** Test Cases ***
Test With Linux Module
    Open Session    alias=server    protocol=ssh    product=bash
    ...             host=192.168.1.100    login=user    password=pass
    
    Load Module    linux
    
    ${system_info}=    Get System Info    server
    Log    System info: ${system_info}
    
    ${processes}=    List Processes    server
    Log    Processes: ${processes}
    
    Close All Sessions
----

=== Database Listener Plugin

Store test results in a database:

[source,bash]
----
# Run tests with the listener
robot --listener sysbot.plugins.listener.DatabaseListener:sqlite:results.db:MyCampaign tests/
----

== Python unittest Integration

=== Basic Example

==== SSH Connection Test

[source,python]
----
import unittest
from sysbot.Sysbot import Sysbot


class TestSSHConnection(unittest.TestCase):
    
    def setUp(self):
        """Setup before each test"""
        self.bot = Sysbot()
    
    def tearDown(self):
        """Cleanup after each test"""
        self.bot.close_all_sessions()
    
    def test_basic_ssh_connection(self):
        """Test a basic SSH connection"""
        self.bot.open_session(
            alias="test_server",
            protocol="ssh",
            product="bash",
            host="192.168.1.100",
            login="user",
            password="password"
        )
        
        result = self.bot.execute_command("test_server", "hostname")
        self.assertIsNotNone(result)
        self.assertIn("Result", result)


if __name__ == '__main__':
    unittest.main()
----

==== WinRM Connection Test

[source,python]
----
import unittest
from sysbot.Sysbot import Sysbot


class TestWindowsConnection(unittest.TestCase):
    
    def setUp(self):
        self.bot = Sysbot()
        self.bot.open_session(
            alias="windows_server",
            protocol="winrm",
            product="powershell",
            host="192.168.1.200",
            login="administrator",
            password="password"
        )
    
    def tearDown(self):
        self.bot.close_all_sessions()
    
    def test_get_computer_info(self):
        """Test getting computer information"""
        result = self.bot.execute_command(
            "windows_server", 
            "Get-ComputerInfo"
        )
        self.assertEqual(result["StatusCode"], 0)
        self.assertIn("Windows", result["Result"])


if __name__ == '__main__':
    unittest.main()
----

=== Test Organization

==== Using setUpClass and tearDownClass

For shared resources across tests:

[source,python]
----
import unittest
from sysbot.Sysbot import Sysbot


class TestLinuxSuite(unittest.TestCase):
    
    @classmethod
    def setUpClass(cls):
        """Setup once for the entire test class"""
        cls.bot = Sysbot()
        cls.bot.open_session(
            alias="linux_server",
            protocol="ssh",
            product="bash",
            host="192.168.1.100",
            login="user",
            password="password"
        )
    
    @classmethod
    def tearDownClass(cls):
        """Cleanup after all tests"""
        cls.bot.close_all_sessions()
    
    def test_filesystem(self):
        """Test filesystem operations"""
        result = self.bot.execute_command("linux_server", "ls -la /tmp")
        self.assertEqual(result["StatusCode"], 0)
    
    def test_processes(self):
        """Test process operations"""
        result = self.bot.execute_command("linux_server", "ps aux")
        self.assertEqual(result["StatusCode"], 0)


if __name__ == '__main__':
    unittest.main()
----

=== Running Tests

[source,bash]
----
# Discover and run all tests
python -m unittest discover tests

# Run a specific test file
python -m unittest tests.test_connections

# Run a specific test class
python -m unittest tests.test_connections.TestSSHConnection

# Run verbose mode
python -m unittest discover tests -v
----

== Database Listener Plugin

A Robot Framework listener plugin that stores test execution results in various databases using SQLAlchemy for SQL databases.

=== Supported Databases

* *SQLite* - File-based database
* *MySQL* - Relational database
* *PostgreSQL* - Advanced relational database
* *MongoDB* - NoSQL document database

=== Installation

==== Using pip with extras

[source,bash]
----
# Install with all database support
pip install sysbot[all_databases]

# Or install with specific database support
pip install sysbot[mysql]
pip install sysbot[postgresql]
pip install sysbot[mongodb]
----

=== Usage

The listener can be used with Robot Framework's `--listener` option:

[source,bash]
----
robot --listener sysbot.plugins.listener.DatabaseListener:db_type:connection_string:campaign_name tests/
----

==== SQLite Examples

[source,bash]
----
# Store results in results.db file with campaign name
robot --listener sysbot.plugins.listener.DatabaseListener:sqlite:results.db:MyCampaign tests/

# Store results in /tmp/test_results.db
robot --listener sysbot.plugins.listener.DatabaseListener:sqlite:/tmp/test_results.db:MyProject tests/
----

==== MySQL Examples

[source,bash]
----
# Connect to MySQL database
robot --listener sysbot.plugins.listener.DatabaseListener:mysql:user:password@localhost/testdb:MyCampaign tests/

# With custom port
robot --listener sysbot.plugins.listener.DatabaseListener:mysql:user:password@localhost:3307/testdb:MyCampaign tests/
----

==== PostgreSQL Examples

[source,bash]
----
# Connect to PostgreSQL database
robot --listener sysbot.plugins.listener.DatabaseListener:postgresql:user:password@localhost/testdb:MyCampaign tests/

# With custom port
robot --listener sysbot.plugins.listener.DatabaseListener:postgresql:user:password@localhost:5433/testdb:MyCampaign tests/
----

==== MongoDB Examples

[source,bash]
----
# Connect to MongoDB database
robot --listener sysbot.plugins.listener.DatabaseListener:mongodb:mongodb://localhost:27017/testdb:MyCampaign tests/

# With authentication
robot --listener sysbot.plugins.listener.DatabaseListener:mongodb:user:password@localhost:27017/testdb:MyCampaign tests/
----

=== Database Schema

==== SQL Databases (SQLite, MySQL, PostgreSQL)

The listener creates a hierarchical structure with four tables:

*test_campaigns*

[cols="1,1,3"]
|===
|Column |Type |Description

|id
|INTEGER/SERIAL
|Primary key

|name
|VARCHAR(500)
|Campaign name

|start_time
|TIMESTAMP
|Campaign start time

|end_time
|TIMESTAMP
|Campaign end time

|description
|TEXT
|Campaign description
|===

*test_suites*

[cols="1,1,3"]
|===
|Column |Type |Description

|id
|INTEGER/SERIAL
|Primary key

|campaign_id
|INTEGER
|Foreign key to test_campaigns

|name
|VARCHAR(500)
|Suite name

|doc
|TEXT
|Suite documentation

|start_time
|TIMESTAMP
|Suite start time

|end_time
|TIMESTAMP
|Suite end time

|status
|VARCHAR(50)
|Suite status (PASS/FAIL)

|message
|TEXT
|Suite message

|metadata
|TEXT
|Suite metadata (JSON)
|===

*test_cases*

[cols="1,1,3"]
|===
|Column |Type |Description

|id
|INTEGER/SERIAL
|Primary key

|suite_id
|INTEGER
|Foreign key to test_suites

|name
|TEXT
|Test case name

|doc
|TEXT
|Test case documentation

|tags
|TEXT
|Test case tags (comma-separated)

|start_time
|TIMESTAMP
|Test start time

|end_time
|TIMESTAMP
|Test end time

|status
|TEXT
|Test status (PASS/FAIL)

|message
|TEXT
|Test message
|===

*keywords*

[cols="1,1,3"]
|===
|Column |Type |Description

|id
|INTEGER/SERIAL
|Primary key

|test_id
|INTEGER
|Foreign key to test_cases

|name
|TEXT
|Keyword name

|library
|TEXT
|Library name

|start_time
|TIMESTAMP
|Keyword start time

|end_time
|TIMESTAMP
|Keyword end time

|status
|TEXT
|Keyword status

|message
|TEXT
|Keyword message
|===

==== MongoDB

The listener creates three collections with similar structure:

* `test_suites`
* `test_cases`
* `keywords`

=== Querying Results

==== SQLite

[source,bash]
----
# View all test suites
sqlite3 results.db "SELECT * FROM test_suites;"

# View all test cases with their status
sqlite3 results.db "SELECT name, status, start_time, end_time FROM test_cases;"

# Count tests by status
sqlite3 results.db "SELECT status, COUNT(*) FROM test_cases GROUP BY status;"

# View failed tests
sqlite3 results.db "SELECT name, message FROM test_cases WHERE status='FAIL';"
----

== Troubleshooting

=== Common Connection Issues

==== SSH Connection Refused

[source,text]
----
Ensure SSH server is running
Check firewall and network security rules
Verify credentials and permissions
----

==== WinRM Timeout

[source,text]
----
Check that WinRM is enabled on the Windows server
Verify port configuration (5986 for HTTPS, 5985 for HTTP)
Ensure firewall rules allow WinRM connection
----

==== HTTP Authentication Errors

[source,text]
----
Verify authentication method is correct
Check that credentials are valid
Ensure the API expects the authentication format you're using
----

== Support

For bug reports and feature requests, please use the GitHub issue tracker:
https://github.com/JoReci2/sysbot/issues

== Author

Thibault SCIRE - https://github.com/thibaultscire

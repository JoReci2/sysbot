= References

== Introduction

This document provides comprehensive API reference documentation for SysBot components, including core methods, connectors, modules, and plugins.

== Core API

=== Sysbot Class

The main class for interacting with SysBot.

==== Constructor

[source,python]
----
Sysbot(*modules)
----

**Parameters:**

* `*modules` (optional): Specific modules to load (e.g., "linux.systemd", "windows.file")
  - If no modules specified, all available modules are loaded

**Example:**

[source,python]
----
# Load all modules
bot = Sysbot()

# Load specific modules
bot = Sysbot("linux.systemd", "linux.dnf", "windows.file")
----

=== Session Management

==== open_session()

[source,python]
----
open_session(alias, protocol, product, host, port, login, password, 
             tunnel_config=None, is_secret=False)
----

Open a connection session to a remote system.

**Parameters:**

* `alias` (str): Unique identifier for the session
* `protocol` (str): Connection protocol - "ssh", "winrm", "http", "socket"
* `product` (str): Product type:
  - SSH: "bash", "powershell"
  - WinRM: "powershell"
  - HTTP: "basicauth", "apikey", "oauth1", "oauth2", "jwt", "saml", "hmac", "certificate", "openidconnect"
  - Socket: "tcp", "udp"
* `host` (str): Target host address or IP
* `port` (int): Connection port (optional, uses defaults from config)
* `login` (str): Username for authentication
* `password` (str): Password for authentication
* `tunnel_config` (list, optional): SSH tunnel configuration
* `is_secret` (bool, optional): Whether parameters are secret keys

**Returns:** None

**Raises:** Exception if connection fails

**Example:**

[source,python]
----
# Basic SSH connection
bot.open_session("server1", "ssh", "bash", "192.168.1.100", 22, 
                "user", "pass")

# WinRM connection
bot.open_session("win1", "winrm", "powershell", "192.168.1.200", 
                5986, "admin", "pass")

# Connection with secrets
bot.open_session("server2", "ssh", "bash", "config.host", 22,
                "config.user", "config.pass", is_secret=True)
----

==== close_session()

[source,python]
----
close_session(alias)
----

Close a specific session.

**Parameters:**

* `alias` (str): Session identifier

**Returns:** None

**Example:**

[source,python]
----
bot.close_session("server1")
----

==== close_all_sessions()

[source,python]
----
close_all_sessions()
----

Close all open sessions and clean up resources.

**Returns:** None

**Example:**

[source,python]
----
bot.close_all_sessions()
----

=== Command Execution

==== execute_command()

[source,python]
----
execute_command(alias, command)
----

Execute a command on a remote system.

**Parameters:**

* `alias` (str): Session identifier
* `command` (str): Command to execute

**Returns:** dict with keys:

* `StatusCode` (int): Exit code (0 = success)
* `Result` (str): Command output
* `Error` (str): Error message (if any)
* `Metadata` (dict): Additional metadata

**Example:**

[source,python]
----
result = bot.execute_command("server1", "ls -la")
print(f"Status: {result['StatusCode']}")
print(f"Output: {result['Result']}")
print(f"Error: {result['Error']}")
----

=== Secret Management

==== add_secret()

[source,python]
----
add_secret(key, value)
----

Store a secret value.

**Parameters:**

* `key` (str): Secret identifier
* `value` (any): Value to store

**Returns:** None

**Example:**

[source,python]
----
bot.add_secret("db_password", "super_secret")
bot.add_secret("api_key", "abc123xyz")
----

==== get_secret()

[source,python]
----
get_secret(key)
----

Retrieve a secret value.

**Parameters:**

* `key` (str): Secret identifier (supports dot notation for nested values)

**Returns:** The secret value

**Raises:** KeyError if secret not found

**Example:**

[source,python]
----
password = bot.get_secret("db_password")
nested = bot.get_secret("config.database.host")
----

==== remove_secret()

[source,python]
----
remove_secret(key)
----

Remove a secret from storage.

**Parameters:**

* `key` (str): Secret identifier

**Returns:** None

**Raises:** KeyError if secret not found

**Example:**

[source,python]
----
bot.remove_secret("db_password")
----

=== Component Access

==== Call Components

[source,python]
----
# Access modules
bot.linux.file.exists(alias, path)
bot.linux.systemd.list_units(alias)
bot.windows.file.exists(alias, path)

# Access plugins
bot.plugins.data.csv(filepath, key=None)
bot.plugins.data.yaml(filepath, key=None)
bot.plugins.data.json(filepath, key=None)
----

**Robot Framework:**

[source,robot]
----
# Call module functions
${result}=    Call Components    linux.file.exists    server1    /etc/hosts

# Call plugin functions
${data}=    Call Components    plugins.data.yaml    config.yml
Call Components    plugins.data.yaml    config.yml    key=config
----

== Connectors Reference

All connectors follow the same interface and return standardized responses.

=== Standard Response Format

[source,python]
----
{
    "StatusCode": 0,        # Exit code (0 = success, non-zero = error)
    "Result": "...",        # Command output or result data
    "Error": "",            # Error message (empty if successful)
    "Metadata": {}          # Additional connector-specific metadata
}
----

=== SSH Connector

==== Configuration

* **Default Port**: 22
* **Products**: "bash", "powershell"
* **Library**: Netmiko with automatic device type detection

==== Usage

[source,python]
----
# Bash over SSH
bot.open_session("linux", "ssh", "bash", "192.168.1.100", 22, 
                "user", "pass")

# PowerShell over SSH (requires SSH server with PowerShell)
bot.open_session("linux_pwsh", "ssh", "powershell", "192.168.1.100", 
                22, "user", "pass")
----

=== WinRM Connector

==== Configuration

* **Default Port**: 5986 (HTTPS)
* **Products**: "powershell"
* **Library**: pywinrm

==== Special Features

* PowerShell commands are base64 encoded before transmission
* Automatic output encoding handling

==== Usage

[source,python]
----
bot.open_session("windows", "winrm", "powershell", "192.168.1.200", 
                5986, "admin", "pass")
----

=== HTTP Connector

==== Configuration

* **Default Ports**: 80 (HTTP), 443 (HTTPS)
* **Products**: "basicauth", "apikey", "oauth1", "oauth2", "jwt", "saml", "hmac", "certificate", "openidconnect"

==== Usage

[source,python]
----
# Basic authentication
bot.open_session("api", "http", "basicauth", "api.example.com",
                443, "user", "pass")

# vSphere connection (using basicauth)
bot.open_session("vcenter", "http", "basicauth", "vcenter.example.com",
                443, "administrator@vsphere.local", "pass")

# Get vSphere servers (using vmware.vsphere module)
bot.vmware.vsphere.list_vms("vcenter")
----

=== Socket Connector

==== Configuration

* **Products**: "tcp", "udp"
* **Optional SSL**: Supported for TCP

==== Usage

[source,python]
----
# TCP socket
bot.open_session("tcp_server", "socket", "tcp", "192.168.1.100", 
                8080, "", "")

# UDP socket
bot.open_session("udp_server", "socket", "udp", "192.168.1.100", 
                8080, "", "")
----

=== Localhost Connector

==== Configuration

* **Purpose**: Local command execution without network connections
* **No credentials required**

==== Usage

[source,python]
----
# Local bash commands
bot.open_session("local", "localhost", "bash", "localhost", 0, "", "")
result = bot.execute_command("local", "ls -la")
----

== Modules Reference

=== Linux Modules

==== linux.file

File system operations on Linux systems.

**Functions:**

[source,python]
----
# Check if file/directory exists
exists(connector, alias, path) -> bool

# Read file contents
read(connector, alias, path) -> str

# Write to file
write(connector, alias, path, content) -> bool

# Check file permissions
permissions(connector, alias, path) -> dict

# Create directory
mkdir(connector, alias, path) -> bool

# Remove file/directory
remove(connector, alias, path) -> bool
----

**Example:**

[source,python]
----
# Python
bot = Sysbot("linux.file")
bot.open_session("server", "ssh", "bash", "192.168.1.100", 22, 
                "user", "pass")
exists = bot.linux.file.exists("server", "/etc/hosts")
content = bot.linux.file.read("server", "/etc/hostname")
----

[source,robot]
----
# Robot Framework
${exists}=    Call Components    linux.file.exists    server    /etc/hosts
${content}=   Call Components    linux.file.read      server    /etc/hostname
----

==== linux.systemd

Systemd service management.

**Functions:**

[source,python]
----
# List all units
list_units(connector, alias) -> list

# Get service status
status(connector, alias, service_name) -> dict

# Start service
start(connector, alias, service_name) -> bool

# Stop service
stop(connector, alias, service_name) -> bool

# Restart service
restart(connector, alias, service_name) -> bool

# Enable service
enable(connector, alias, service_name) -> bool

# Disable service
disable(connector, alias, service_name) -> bool
----

**Example:**

[source,python]
----
bot = Sysbot("linux.systemd")
bot.open_session("server", "ssh", "bash", "192.168.1.100", 22, 
                "user", "pass")
units = bot.linux.systemd.list_units("server")
status = bot.linux.systemd.status("server", "nginx")
----

==== linux.dnf

DNF package manager operations (RHEL/Fedora).

**Functions:**

[source,python]
----
# List repositories
repolist(connector, alias) -> list

# Install package
install(connector, alias, package_name) -> bool

# Remove package
remove(connector, alias, package_name) -> bool

# Update package
update(connector, alias, package_name) -> bool

# Search for package
search(connector, alias, query) -> list

# Check for updates
check_update(connector, alias) -> list
----

=== Windows Modules

==== windows.file

File system operations on Windows systems.

**Functions:**

[source,python]
----
# Check if file/directory exists
exists(connector, alias, path) -> bool

# Read file contents
read(connector, alias, path) -> str

# Write to file
write(connector, alias, path, content) -> bool

# Get file permissions (ACL)
permissions(connector, alias, path) -> dict

# Create directory
mkdir(connector, alias, path) -> bool

# Remove file/directory
remove(connector, alias, path) -> bool
----

**Example:**

[source,python]
----
bot = Sysbot("windows.file")
bot.open_session("win", "winrm", "powershell", "192.168.1.200", 
                5986, "admin", "pass")
exists = bot.windows.file.exists("win", "C:\\Windows")
----

==== windows.adds

Active Directory Domain Services operations.

**Functions:**

[source,python]
----
# Get domain information
get_domain(connector, alias) -> dict

# Get user information
get_user(connector, alias, username) -> dict

# Get group information
get_group(connector, alias, groupname) -> dict

# Get organizational unit
get_ou(connector, alias, ou_path) -> dict

# Get domain controller
get_dc(connector, alias) -> dict
----

==== windows.adcs

Active Directory Certificate Services operations.

**Functions:**

[source,python]
----
# Get CA information
get_ca(connector, alias) -> dict

# Get CA properties
get_ca_property(connector, alias) -> dict

# Get issued certificates
get_issued_request(connector, alias) -> list

# Get pending requests
get_pending_request(connector, alias) -> list

# Get failed requests
get_failed_request(connector, alias) -> list

# Get revoked certificates
get_revoked_request(connector, alias) -> list

# Get certificate templates
get_ca_template(connector, alias) -> list

# Get CRL distribution points
get_ca_crl_distribution_point(connector, alias) -> list
----

==== windows.dnsserver

DNS Server management.

**Functions:**

[source,python]
----
# Get DNS server configuration
get_server(connector, alias) -> dict

# Get DNS zones
get_zone(connector, alias) -> list

# Get DNS records
get_resource_record(connector, alias, zone_name) -> list

# Get forwarders
get_forwarder(connector, alias) -> list

# Get cache
get_cache(connector, alias) -> dict

# Get statistics
get_statistics(connector, alias) -> dict

# Get DNS server settings
get_setting(connector, alias) -> dict
----

==== windows.veeam

Veeam Backup & Replication operations.

**Functions:**

[source,python]
----
# Get Veeam servers
get_server(connector, alias) -> list

# Get backup repositories
get_repository(connector, alias) -> list

# Get backup jobs
get_job(connector, alias) -> list

# Get backups
get_backup(connector, alias) -> list

# Get restore points
get_restore_point(connector, alias) -> list

# Get backup sessions
get_session(connector, alias) -> list

# Get vSphere servers
get_vi_server(connector, alias) -> list

# Get server sessions
get_server_session(connector, alias) -> list
----

==== windows.wsus

Windows Server Update Services operations.

**Functions:**

[source,python]
----
# Get WSUS server information
get_server(connector, alias) -> dict

# Get updates
get_update(connector, alias, classification, approval_state) -> list

# Get computers
get_computer(connector, alias) -> list

# Get update classifications
get_classification(connector, alias) -> list

# Get products
get_product(connector, alias) -> list
----

==== windows.firewall

Windows Firewall management.

**Functions:**

[source,python]
----
# Get firewall profile
get_profile(connector, alias) -> dict

# Get firewall rules
get_rule(connector, alias) -> list

# Enable rule
enable_rule(connector, alias, rule_name) -> bool

# Disable rule
disable_rule(connector, alias, rule_name) -> bool

# Create rule
new_rule(connector, alias, rule_params) -> bool

# Remove rule
remove_rule(connector, alias, rule_name) -> bool
----

== Plugins Reference

=== data Plugin

Load data from various file formats.

==== csv()

[source,python]
----
csv(filepath, key=None)
----

Load CSV file.

**Parameters:**

* `filepath` (str): Path to CSV file
* `key` (str, optional): Store in secret manager with this key

**Returns:**

* List of dictionaries (without key)
* "Imported" (with key)

**Example:**

[source,python]
----
# Load directly
data = bot.plugins.data.csv("data.csv")
print(data[0]["name"])

# Load as secret
bot.plugins.data.csv("data.csv", key="csv_data")
name = bot.get_secret("csv_data.0.name")
----

==== yaml()

[source,python]
----
yaml(filepath, key=None)
----

Load YAML file.

**Parameters:**

* `filepath` (str): Path to YAML file
* `key` (str, optional): Store in secret manager with this key

**Returns:**

* Dictionary/list (without key)
* "Imported" (with key)

**Example:**

[source,python]
----
# Load directly
config = bot.plugins.data.yaml("config.yml")
print(config["database"]["host"])

# Load as secret
bot.plugins.data.yaml("config.yml", key="config")
host = bot.get_secret("config.database.host")
----

==== json()

[source,python]
----
json(filepath, key=None)
----

Load JSON file.

**Parameters:**

* `filepath` (str): Path to JSON file
* `key` (str, optional): Store in secret manager with this key

**Returns:**

* Dictionary/list (without key)
* "Imported" (with key)

**Example:**

[source,python]
----
# Load directly
data = bot.plugins.data.json("data.json")
print(data["users"][0]["name"])

# Load as secret
bot.plugins.data.json("data.json", key="app_data")
user = bot.get_secret("app_data.users.0.name")
----

== Configuration Reference

=== Default Ports

Defined in `sysbot/connectors/config.py`:

[source,python]
----
DEFAULT_PORTS = {
    "ssh": 22,
    "winrm": 5986,
    "http": 80,
    "https": 443
}
----

=== Connector Response Structure

All connectors return this standardized format:

[source,python]
----
{
    "StatusCode": 0,          # Exit/status code
    "Result": "",             # Output or result data
    "Error": "",              # Error message
    "Metadata": {}            # Additional information
}
----

== Error Handling

=== Common Exceptions

* `Exception`: General SysBot errors
* `KeyError`: Secret not found
* `ConnectionError`: Connection failures
* `TimeoutError`: Operation timeout

=== Error Handling Example

[source,python]
----
try:
    bot.open_session("server", "ssh", "bash", "192.168.1.100", 
                    22, "user", "wrong_password")
except Exception as e:
    print(f"Connection failed: {e}")
    
try:
    secret = bot.get_secret("nonexistent")
except KeyError as e:
    print(f"Secret not found: {e}")
----

== Robot Framework Keywords

=== Built-in Keywords

[source,robot]
----
Open Session          alias  protocol  product  host  port  login  password  
                      [tunnel_config]  [is_secret]

Close Session         alias

Close All Sessions

Execute Command       alias  command

Add Secret           key  value

Get Secret           key

Remove Secret        key

Call Components      component_path  [args...]
----

== Best Practices

=== Session Management

* Always close sessions in teardown
* Use meaningful aliases
* Reuse sessions when possible

=== Secret Management

* Store sensitive data in secrets
* Use dot notation for nested access
* Clean up secrets after use

=== Error Handling

* Check StatusCode in results
* Handle exceptions appropriately
* Provide meaningful error messages

=== Performance

* Load only needed modules
* Reuse existing sessions
* Close sessions when done

== Additional Resources

* link:setup.adoc[Setup Guide]
* link:quickstart.adoc[Quick Start]
* link:robotframework.adoc[Robot Framework Guide]
* link:unittest.adoc[unittest Guide]
* link:developer.adoc[Developer Guide]

== Support

For API questions and issues:

* GitHub Issues: https://github.com/JoReci2/sysbot/issues
* GitHub Discussions: https://github.com/JoReci2/sysbot/discussions
* Documentation: https://github.com/JoReci2/sysbot/tree/main/docs

[tox]
envlist = lint,radon,bandit,robot,docs
skipsdist = False

[testenv]
deps =
    robotframework
    paramiko
    sshtunnel
    netmiko
    redfish
    pyVmomi
    pywinrm
    pyOpenSSL
    pytz
    requests
    hvac

[testenv:lint]
description = Run linting checks with ruff and pre-commit
deps =
    {[testenv]deps}
    ruff
    pre-commit
commands =
    pre-commit run --all-files
    ruff check sysbot

[testenv:radon]
description = Check code complexity and maintainability with radon
deps =
    radon
commands =
    radon cc sysbot -a -nb
    radon mi sysbot -nb
    radon raw sysbot -s
    radon hal sysbot

[testenv:bandit]
description = Security vulnerability scanning with bandit
deps =
    bandit[toml]
commands =
    bandit -r sysbot -f json -o bandit-report.json
    bandit -r sysbot

[testenv:robot]
description = Run Robot Framework tests
deps =
    {[testenv]deps}
commands =
    robot --outputdir test-results tests/

[testenv:docs]
description = Build documentation with Antora (requires Node.js and npm)
deps =
commands =
    bash -c "command -v npm > /dev/null || (echo 'Error: npm not found. Install Node.js and npm first' && exit 1)"
    bash -c "npm list -g @antora/cli > /dev/null 2>&1 || npm install -g @antora/cli@3.1 @antora/site-generator@3.1"
    bash -c "if [ -f antora-playbook.yml ]; then antora --fetch antora-playbook.yml; else echo 'Warning: antora-playbook.yml not found, skipping build'; fi"
